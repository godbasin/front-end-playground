(window.webpackJsonp=window.webpackJsonp||[]).push([[182],{742:function(t,s,a){"use strict";a.r(s);var n=a(69),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("项目中需要搭建一个多页面的环境，包括本地路由服务和分页面打包。本节作为首节内容，主要简单介绍一些 webpack 相关的常用配置。")]),t._v(" "),a("h1",{attrs:{id:"webpack-基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-基本概念"}},[t._v("#")]),t._v(" Webpack 基本概念")]),t._v(" "),a("p",[t._v("更多的相关配置小伙伴们可以参考"),a("a",{attrs:{href:"https://godbasin.github.io/2017/05/21/webpack-common-setting/",target:"_blank",rel:"noopener noreferrer"}},[t._v("《正确的 Webpack 配置姿势，快速启动各式框架》"),a("OutboundLink")],1),t._v("。\n这里我们主要介绍搭建时涉及的一些配置。")]),t._v(" "),a("p",[a("strong",[t._v("四个核心概念：入口(entry)、输出(output)、loader、插件(plugins)。")])]),t._v(" "),a("h2",{attrs:{id:"入口-entry"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#入口-entry"}},[t._v("#")]),t._v(" 入口(entry)")]),t._v(" "),a("p",[t._v("将您应用程序的入口起点认为是根上下文(contextual root)或 app 第一个启动文件。\n一般来说，在 Angular 中我们将是启动"),a("code",[t._v(".bootstrap()")]),t._v("的文件，在 Vue 中则是"),a("code",[t._v("new Vue()")]),t._v("的位置，在 React 中则是"),a("code",[t._v("ReactDOM.render()")]),t._v("或者是"),a("code",[t._v("React.render()")]),t._v("的启动文件。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./path/to/my/entry/file.js"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"出口-output"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#出口-output"}},[t._v("#")]),t._v(" 出口(output)")]),t._v(" "),a("p",[t._v("output 属性描述了如何处理归拢在一起的代码(bundled code)，在哪里打包应用程序。一般需要以下两点：")]),t._v(" "),a("ul",[a("li",[t._v("filename: 编译文件的文件名(main.js/bundle.js/index.js 等)")]),t._v(" "),a("li",[t._v("path：对应一个绝对路径，此路径是你希望一次性打包的目录")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    filename"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bundle.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/proj/public/assets"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"loader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#loader"}},[t._v("#")]),t._v(" loader")]),t._v(" "),a("p",[t._v("webpack 把每个文件(.css, .html, .scss, .jpg, etc.) 都作为模块处理。但 webpack 只理解 JavaScript。")]),t._v(" "),a("p",[t._v("如果你看过生成的"),a("code",[t._v("bundle.js")]),t._v("代码就会发现，Webpack 将所有的模块打包一起，每个模块添加标记 id，通过这样一个 id 去获取所需模块的代码。\n而我们的 loader 的作用，就是把不同的模块和文件转换为这样一个模块，打包进去。")]),t._v(" "),a("p",[a("strong",[t._v("loader 支持链式传递。能够对资源使用流水线(pipeline)。loader 链式地按照先后顺序进行编译，从后往前，最终需要返回 javascript。")])]),t._v(" "),a("p",[t._v("不同的应用场景需要不同的 loader，这里我简单介绍几个（loader 使用前都需要安装，请自行查找依赖安装）：")]),t._v(" "),a("ul",[a("li",[t._v("babel-loader")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://babeljs.io/learn-es2015/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),a("OutboundLink")],1),t._v("在此，想要了解的也可以参考"),a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/01/babel.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Babel 入门教程"),a("OutboundLink")],1),t._v("。\n"),a("code",[t._v("babel-loader")]),t._v("将 ES6/ES7 语法编译生成 ES5，当然有些特性还是需要"),a("code",[t._v("babel-polyfill")]),t._v("支持的（Babel 默认只转换新的 JavaScript 句法，而不转换新的 API，如 Promise 等全局对象）。")]),t._v(" "),a("p",[t._v("而对于 babel-loader 的配置，可以通过"),a("code",[t._v("options")]),t._v("进行，但一般更常使用"),a("code",[t._v(".babelrc")]),t._v("文件进行：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"presets"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设定转码规则")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"plugins"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 插件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("p",[t._v("css 相关 loader")]),t._v(" "),a("ul",[a("li",[t._v("css-loader: 处理 css 文件中的 url()")]),t._v(" "),a("li",[t._v("style-loader: 将 css 插入到页面的 style 标签")]),t._v(" "),a("li",[t._v("less-loader: less 转换为 css")]),t._v(" "),a("li",[t._v("postcss-loader(autoprefixer-loader): 自动添加兼容前缀("),a("code",[t._v("-webkit-")]),t._v("、"),a("code",[t._v("-moz-")]),t._v("等)")])])]),t._v(" "),a("li",[a("p",[t._v("url-loader/file-loader: 修改文件名，放在输出目录下，并返其对应的 url")]),t._v(" "),a("ul",[a("li",[t._v("url-loader 在当文件大小小于限制值时，它可以返回一个 Data Url")])])]),t._v(" "),a("li",[a("p",[t._v("html-loader/raw-loader: 把 Html 文件输出成字符串")]),t._v(" "),a("ul",[a("li",[t._v("html-loader 默认处理 html 中的"),a("code",[t._v('<img src="image.png">')]),t._v('为 require("./image.png")，需要在配置中指定 image 文件的加载器')])])])]),t._v(" "),a("h2",{attrs:{id:"插件-plugins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件-plugins"}},[t._v("#")]),t._v(" 插件(plugins)")]),t._v(" "),a("p",[t._v("loader 仅在每个文件的基础上执行转换，"),a("strong",[t._v("插件目的在于解决 loader 无法实现的其他事")]),t._v("。\n由于 plugin 可以携带参数/选项，需要在 wepback 配置中，向 plugins 属性传入"),a("code",[t._v("new")]),t._v("实例。")]),t._v(" "),a("h2",{attrs:{id:"解析-resolve"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解析-resolve"}},[t._v("#")]),t._v(" 解析(resolve)")]),t._v(" "),a("p",[t._v("这些选项能设置模块如何被解析，因为这里会使用到所以也介绍一下用到的：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("resolve.extensions")]),t._v(" "),a("ul",[a("li",[t._v("自动解析确定的扩展。默认值为："),a("code",[t._v('[".js", ".json"]')])])])]),t._v(" "),a("li",[a("p",[t._v("resolve.alias")]),t._v(" "),a("ul",[a("li",[t._v("创建"),a("code",[t._v("import")]),t._v("或"),a("code",[t._v("require")]),t._v("的别名，来确保模块引入变得更简单。\n"),a("blockquote",[a("p",[t._v("如果使用 typescript 的话，我们还需要配置"),a("code",[t._v("tsconfig.json")]),t._v("：")])])])])])]),t._v(" "),a("h1",{attrs:{id:"项目配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目配置"}},[t._v("#")]),t._v(" 项目配置")]),t._v(" "),a("h2",{attrs:{id:"目录组织"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录组织"}},[t._v("#")]),t._v(" 目录组织")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("├── build/                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# webpack配置参数文件")]),t._v("\n│   └── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n├── src/                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 项目代码入口")]),t._v("\n│   ├── page1/                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第一个页面或者应用")]),t._v("\n│   │   ├── main.js             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 页面/应用入口文件")]),t._v("\n│   │   └── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n│   └── page2/                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第二个页面或者应用")]),t._v("\n│   │   ├── main.js             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 页面/应用入口文件")]),t._v("\n│   │   └── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n│   └── pageN/                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第N个页面或者应用")]),t._v("\n│       ├── main.js             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 页面/应用入口文件")]),t._v("\n│       └── "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n├── .babelrc                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# babel编译参数")]),t._v("\n├── index.html                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主页模板，所有的页面共用该index.html入口")]),t._v("\n└── package.json                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 项目文件，记载着一些命令和依赖还有简要的项目描述信息")]),t._v("\n")])])]),a("h2",{attrs:{id:"基本配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本配置文件"}},[t._v("#")]),t._v(" 基本配置文件")]),t._v(" "),a("p",[t._v("由于我们需要实现开发时多页面共同启动，打包时分块打包的功能，故在不同环境下我们的入口"),a("code",[t._v("entry")]),t._v("和"),a("code",[t._v("plugins")]),t._v("等将会不一致，这里我们先省略：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" webpackConfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  entry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  output"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dist"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    filename"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./[hash].js"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  resolve"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    extensions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '.ts' and more")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  module"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        test"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token regex"}},[a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),a("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        loader"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"babel-loader"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        include"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./src"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// more loaders...")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" webpackConfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h1",{attrs:{id:"结束语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结束语"}},[t._v("#")]),t._v(" 结束语")]),t._v(" "),a("p",[t._v("这里我们搭建了最基本的目录结构以及不完整的 webpack 配置，后续我们将深入进行 build 和 dev 的过程。"),a("br"),t._v("\n目前的代码并没有什么太大的作用，后面补上完整项目的代码吧。")])])}),[],!1,null,null,null);s.default=e.exports}}]);