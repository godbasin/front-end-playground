<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>14.Ivy编译器之增量DOM | 被删的前端游乐场</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/front-end-playground/assets/css/0.styles.a0b3413c.css" as="style"><link rel="preload" href="/front-end-playground/assets/js/app.ef7e5b0a.js" as="script"><link rel="preload" href="/front-end-playground/assets/js/2.e5aa9928.js" as="script"><link rel="preload" href="/front-end-playground/assets/js/3.ab142917.js" as="script"><link rel="preload" href="/front-end-playground/assets/js/33.1c65d23c.js" as="script">
    <link rel="stylesheet" href="/front-end-playground/assets/css/0.styles.a0b3413c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/front-end-playground/" class="home-link router-link-active"><!----> <span class="site-name">被删的前端游乐场</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front-end-playground/" class="nav-link">概述</a></div><div class="nav-item"><a href="/front-end-playground/front-end-basic/" class="nav-link">前端领域</a></div><div class="nav-item"><a href="/front-end-playground/vue/" class="nav-link">Vue学习</a></div><div class="nav-item"><a href="/front-end-playground/wxapp/" class="nav-link">小程序学习</a></div><div class="nav-item"><a href="/front-end-playground/angular/" class="nav-link router-link-active">Angular学习</a></div><div class="nav-item"><a href="/front-end-playground/front-end-others/" class="nav-link">百家齐放</a></div><div class="nav-item"><a href="/front-end-playground/front-end-addon/" class="nav-link">前端的进击</a></div><div class="nav-item"><a href="/front-end-playground/front-end-work/" class="nav-link">前端与工作</a></div><div class="nav-item"><a href="/front-end-playground/faq.html" class="nav-link">FAQ</a></div> <a href="https://github.com/godbasin/front-end-playground" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front-end-playground/" class="nav-link">概述</a></div><div class="nav-item"><a href="/front-end-playground/front-end-basic/" class="nav-link">前端领域</a></div><div class="nav-item"><a href="/front-end-playground/vue/" class="nav-link">Vue学习</a></div><div class="nav-item"><a href="/front-end-playground/wxapp/" class="nav-link">小程序学习</a></div><div class="nav-item"><a href="/front-end-playground/angular/" class="nav-link router-link-active">Angular学习</a></div><div class="nav-item"><a href="/front-end-playground/front-end-others/" class="nav-link">百家齐放</a></div><div class="nav-item"><a href="/front-end-playground/front-end-addon/" class="nav-link">前端的进击</a></div><div class="nav-item"><a href="/front-end-playground/front-end-work/" class="nav-link">前端与工作</a></div><div class="nav-item"><a href="/front-end-playground/faq.html" class="nav-link">FAQ</a></div> <a href="https://github.com/godbasin/front-end-playground" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0" style="padding-top:10px;"><div class="kitty-main" data-v-2b653b36><span class="stand" data-v-2b653b36></span> <div class="cat" data-v-2b653b36><div class="body" data-v-2b653b36></div> <div class="head" data-v-2b653b36><div class="ear" data-v-2b653b36></div> <div class="ear" data-v-2b653b36></div></div> <div class="face" data-v-2b653b36><div class="nose" data-v-2b653b36></div> <div class="whisker-container" data-v-2b653b36><div class="whisker" data-v-2b653b36></div> <div class="whisker" data-v-2b653b36></div></div> <div class="whisker-container" data-v-2b653b36><div class="whisker" data-v-2b653b36></div> <div class="whisker" data-v-2b653b36></div></div></div> <div class="tail-container" data-v-2b653b36><div class="tail" data-v-2b653b36><div class="tail" data-v-2b653b36><div class="tail" data-v-2b653b36><div class="tail" data-v-2b653b36><div class="tail" data-v-2b653b36><div class="tail" data-v-2b653b36><div class="tail" data-v-2b653b36></div></div></div></div></div></div></div></div></div></div> <p class="sidebar-heading open"><span>Angular框架解读</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-0-prestart.html" class="sidebar-link">0.预热篇</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-metadata.html" class="sidebar-link">1.元数据和装饰器</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-dom-define.html" class="sidebar-link">2.视图抽象定义</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-zonejs.html" class="sidebar-link">3.Zone区域之zone.js</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-zone-ngzone.html" class="sidebar-link">4.Zone区域之ngZone</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-module.html" class="sidebar-link">5.模块化组织</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-di-1-basic-concepts.html" class="sidebar-link">6.依赖注入的基本概念</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-di-2-hierarchical-di.html" class="sidebar-link">7.多级依赖注入设计</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-di-3-bootstrap.html" class="sidebar-link">8.依赖注入的引导过程</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-0-design.html" class="sidebar-link">9.Ivy编译器整体设计</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-1-view-data-and-node-injector.html" class="sidebar-link">10.Ivy编译器的视图数据和依赖解析</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-2-cli-compiler.html" class="sidebar-link">11.Ivy编译器之CLI编译器</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-3-mental-model.html" class="sidebar-link">12.Ivy编译器之心智模型</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-4-aot-jit.html" class="sidebar-link">13.Ivy编译器之AOT/JIT</a></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-5-incremental-dom.html" aria-current="page" class="active sidebar-link">14.Ivy编译器之增量DOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-5-incremental-dom.html#增量-dom" class="sidebar-link">增量 DOM</a></li><li class="sidebar-sub-header"><a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-5-incremental-dom.html#ivy-中的增量-dom" class="sidebar-link">Ivy 中的增量 DOM</a></li><li class="sidebar-sub-header"><a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-5-incremental-dom.html#结束语" class="sidebar-link">结束语</a></li></ul></li><li><a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-6-detect-change.html" class="sidebar-link">15.Ivy编译器之变更检测</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0" style="padding-top:;"><!----> <p class="sidebar-heading"><span>玩转 Angular</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>作为“为大型前端项目”而设计的前端框架，Angular 其实有许多值得参考和学习的设计，本系列主要用于研究这些设计和功能的实现原理。本文围绕 Angular 的核心功能 Ivy 编译器，介绍其中的增量 DOM 设计。</p> <p>在介绍前端框架的时候，我常常会介绍到模板引擎。对于模板引擎的渲染过程，像 Vue/React 这样的框架里，使用了虚拟 DOM 这样的设计。</p> <p>在 Angular Ivy 编译器中，并没有使用虚拟 DOM，而且使用了增量 DOM。</p> <h2 id="增量-dom"><a href="#增量-dom" class="header-anchor">#</a> 增量 DOM</h2> <p>前面在<a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-0-design.html">《9.Ivy 编译器整体设计》</a>一文中，我有介绍在 Ivy 编译器里，模板编译后的产物与 View Engine 不一样了，这是为了支持单独编译、增量编译等能力。</p> <p>比如，<code>&lt;span&gt;My name is &lt;/span&gt;</code>这句模板代码，在 Ivy 编译器中编译后的代码大概长这个样子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// create mode</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>rf <span class="token operator">&amp;</span> RenderFlags<span class="token punctuation">.</span>Create<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">elementStart</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;span&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">text</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">elementEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// update mode</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>rf <span class="token operator">&amp;</span> RenderFlags<span class="token punctuation">.</span>Update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">textBinding</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token function">interpolation1</span><span class="token punctuation">(</span><span class="token string">&quot;My name is&quot;</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，相比于 View Engine 中的<code>elementDef(0,null,null,1,'span',...),</code>，<code>elementStart()</code>、<code>elementEnd()</code>这些 API 显得更加清爽，它们使用的便是增量 DOM 的设计。</p> <h3 id="增量-dom-vs-虚拟-dom"><a href="#增量-dom-vs-虚拟-dom" class="header-anchor">#</a> 增量 DOM vs 虚拟 DOM</h3> <p>虚拟 DOM 想必大家都已经有所了解，它的核心计算过程包括：</p> <ol><li>用 JavaScript 对象模拟 DOM 树，得到一棵虚拟 DOM 树。</li> <li>当页面数据变更时，生成新的虚拟 DOM 树，比较新旧两棵虚拟 DOM 树的差异。</li> <li>把差异应用到真正的 DOM 树上。</li></ol> <p>虽然虚拟 DOM 解决了页面被频繁更新和渲染带来的性能问题，但传统虚拟 DOM 依然有以下性能瓶颈：</p> <ul><li>在单个组件内部依然需要遍历该组件的整个虚拟 DOM 树</li> <li>在一些组件整个模版内只有少量动态节点的情况下，这些遍历都是性能的浪费</li> <li>递归遍历和更新逻辑容易导致 UI 渲染被阻塞，用户体验下降</li></ul> <p>针对这些情况，React 和 Vue 等框架也有更多的优化，比如 React 中分别对 tree diff、component diff 以及 element diff 进行了算法优化，同时引入了任务调度来控制状态更新的计算和渲染。在 Vue 3.0 中，则将虚拟 DOM 的更新从以前的整体作用域调整为树状作用域，树状的结构会带来算法的简化以及性能的提升。</p> <p>而不管怎样，虚拟 DOM 的设计中存在一个无法避免的问题：每个渲染操作分配一个新的虚拟 DOM 树，该树至少大到足以容纳发生变化的节点，并且通常更大一些，这样的设计会导致更多的一些内存占用。当大型虚拟 DOM 树需要大量更新时，尤其是在内存受限的移动设备上，性能可能会受到影响。</p> <p>增量 DOM 的设计核心思想是：</p> <ol><li>在创建新的（虚拟）DOM 树时，沿着现有的树走，并在进行时找出更改。</li> <li>如果没有变化，则不分配内存；</li> <li>如果有，改变现有树（仅在绝对必要时分配内存）并将差异应用到物理 DOM。</li></ol> <p>这里将（虚拟）放在括号中是因为，当将预先计算的元信息混合到现有 DOM 节点中时，使用物理 DOM 树而不是依赖虚拟 DOM 树实际上已经足够快了。</p> <p>与基于虚拟 DOM 的方法相比，增量 DOM 有两个主要优势：</p> <ul><li>增量特性允许在渲染过程中显着减少内存分配，从而实现更可预测的性能</li> <li>它很容易映射到基于模板的方法。控制语句和循环可以与元素和属性声明自由混合</li></ul> <p>增量 DOM 的设计由 Google 提出，同时他们也提供了一个开源库 <a href="https://github.com/google/incremental-dom" target="_blank" rel="noopener noreferrer">google/incremental-dom<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，它是一个用于表达和应用 DOM 树更新的库。JavaScript 可用于提取、迭代数据并将其转换为生成 HTMLElements 和 Text 节点的调用。</p> <p>但新的 Ivy 引擎没有直接使用它，而是实现了自己的版本。</p> <h2 id="ivy-中的增量-dom"><a href="#ivy-中的增量-dom" class="header-anchor">#</a> Ivy 中的增量 DOM</h2> <p>Ivy 引擎基于增量 DOM 的概念，它与虚拟 DOM 方法的不同之处在于，diff 操作是针对 DOM 增量执行的（即一次一个节点），而不是在虚拟 DOM 树上执行。基于这样的设计，增量 DOM 与 Angular 中的脏检查机制其实能很好地搭配。</p> <h3 id="增量-dom-元素创建"><a href="#增量-dom-元素创建" class="header-anchor">#</a> 增量 DOM 元素创建</h3> <p>增量 DOM 的 API 的一个独特功能是它分离了标签的打开（<code>elementStart</code>）和关闭（<code>elementEnd</code>），因此它适合作为模板语言的编译目标，这些语言允许（暂时）模板中的 HTML 不平衡（比如在单独的模板中，打开和关闭的标签）和任意创建 HTML 属性的逻辑。</p> <p>在 Ivy 中，使用<code>elementStart</code>和<code>elementEnd</code>创建一个空的 Element 实现如下（在 Ivy 中，<code>elementStart</code>和<code>elementEnd</code>的具体实现便是<code>ɵɵelementStart</code>和<code>ɵɵelementEnd</code>）：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ɵɵelement</span><span class="token punctuation">(</span>
  index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  attrsIndex<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  localRefsIndex<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token function">ɵɵelementStart</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> name<span class="token punctuation">,</span> attrsIndex<span class="token punctuation">,</span> localRefsIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ɵɵelementEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中，<code>ɵɵelementStart</code>用于创建 DOM 元素，该指令后面必须跟有<code>ɵɵelementEnd()</code>调用。</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ɵɵelementStart</span><span class="token punctuation">(</span>
  index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  attrsIndex<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  localRefsIndex<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> lView <span class="token operator">=</span> <span class="token function">getLView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> tView <span class="token operator">=</span> <span class="token function">getTView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> adjustedIndex <span class="token operator">=</span> <span class="token constant">HEADER_OFFSET</span> <span class="token operator">+</span> index<span class="token punctuation">;</span>

  <span class="token keyword">const</span> renderer <span class="token operator">=</span> lView<span class="token punctuation">[</span><span class="token constant">RENDERER</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 此处创建 DOM 元素</span>
  <span class="token keyword">const</span> native <span class="token operator">=</span> <span class="token punctuation">(</span>lView<span class="token punctuation">[</span>adjustedIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">createElementNode</span><span class="token punctuation">(</span>
    renderer<span class="token punctuation">,</span>
    name<span class="token punctuation">,</span>
    <span class="token function">getNamespace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取 TNode</span>
  <span class="token comment">// 在第一次模板传递中需要收集匹配</span>
  <span class="token keyword">const</span> tNode <span class="token operator">=</span> tView<span class="token punctuation">.</span>firstCreatePass <span class="token operator">?</span>
      <span class="token function">elementStartFirstCreatePass</span><span class="token punctuation">(</span>
          adjustedIndex<span class="token punctuation">,</span> tView<span class="token punctuation">,</span> lView<span class="token punctuation">,</span> native<span class="token punctuation">,</span> name<span class="token punctuation">,</span> attrsIndex<span class="token punctuation">,</span> localRefsIndex<span class="token punctuation">)</span> <span class="token operator">:</span>
      tView<span class="token punctuation">.</span>data<span class="token punctuation">[</span>adjustedIndex<span class="token punctuation">]</span> <span class="token keyword">as</span> TElementNode<span class="token punctuation">;</span>
  <span class="token function">setCurrentTNode</span><span class="token punctuation">(</span>tNode<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> mergedAttrs <span class="token operator">=</span> tNode<span class="token punctuation">.</span>mergedAttrs<span class="token punctuation">;</span>
  <span class="token comment">// 通过推断的渲染器，将所有属性值分配给提供的元素</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mergedAttrs <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setUpAttributes</span><span class="token punctuation">(</span>renderer<span class="token punctuation">,</span> native<span class="token punctuation">,</span> mergedAttrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将 className 写入 RElement</span>
  <span class="token keyword">const</span> classes <span class="token operator">=</span> tNode<span class="token punctuation">.</span>classes<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>classes <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">writeDirectClass</span><span class="token punctuation">(</span>renderer<span class="token punctuation">,</span> native<span class="token punctuation">,</span> classes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将 cssText 写入 RElement</span>
  <span class="token keyword">const</span> styles <span class="token operator">=</span> tNode<span class="token punctuation">.</span>styles<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>styles <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">writeDirectStyle</span><span class="token punctuation">(</span>renderer<span class="token punctuation">,</span> native<span class="token punctuation">,</span> styles<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tNode<span class="token punctuation">.</span>flags <span class="token operator">&amp;</span> TNodeFlags<span class="token punctuation">.</span>isDetached<span class="token punctuation">)</span> <span class="token operator">!==</span> TNodeFlags<span class="token punctuation">.</span>isDetached<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 添加子元素</span>
    <span class="token function">appendChild</span><span class="token punctuation">(</span>tView<span class="token punctuation">,</span> lView<span class="token punctuation">,</span> native<span class="token punctuation">,</span> tNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 组件或模板容器的任何直接子级，必须预先使用组件视图数据进行猴子修补</span>
  <span class="token comment">// 以便稍后可以使用任何元素发现实用程序方法检查元素</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getElementDepthCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">attachPatchData</span><span class="token punctuation">(</span>native<span class="token punctuation">,</span> lView<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">increaseElementDepthCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 对指令 Host 的处理</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDirectiveHost</span><span class="token punctuation">(</span>tNode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">createDirectivesInstances</span><span class="token punctuation">(</span>tView<span class="token punctuation">,</span> lView<span class="token punctuation">,</span> tNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">executeContentQueries</span><span class="token punctuation">(</span>tView<span class="token punctuation">,</span> tNode<span class="token punctuation">,</span> lView<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 获取本地名称和索引的列表，并将解析的本地变量值按加载到模板中的相同顺序推送到 LView</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>localRefsIndex <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">saveResolvedLocalsInData</span><span class="token punctuation">(</span>lView<span class="token punctuation">,</span> tNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，在<code>ɵɵelementStart</code>创建 DOM 元素的过程中，主要依赖于<code>LView</code>、<code>TView</code>和<code>TNode</code>。</p> <p>在 Angular Ivy 中，使用了<code>LView</code>和<code>TView.data</code>来管理和跟踪渲染模板所需要的内部数据。对于<code>TNode</code>，在 Angular 中则是用于在特定类型的所有模板之间共享的特定节点的绑定数据（享元）。关于视图数据相关内容，之前在<a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-1-view-data-and-node-injector.html">《10.Ivy 编译器的视图数据和依赖解析》</a>一节便介绍过了，因此这里不再做详细的介绍。</p> <p><code>ɵɵelementEnd()</code>则用于标记元素的结尾：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">ɵɵelementEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>对于<code>ɵɵelementEnd()</code>的详细实现不过多介绍，基本上主要包括一些对 Class 和样式中<code>@input</code>等指令的处理，循环遍历提供的<code>tNode</code>上的指令、并将要运行的钩子排入队列，元素层次的处理等等。</p> <h3 id="组件创建与增量-dom-指令"><a href="#组件创建与增量-dom-指令" class="header-anchor">#</a> 组件创建与增量 DOM 指令</h3> <p>在增量 DOM 中，每个组件都被编译成一系列指令。这些指令创建 DOM 树并在数据更改时就地更新它们。</p> <p>Ivy 在运行时编译一个组件的过程中，会创建模板解析相关指令：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compileComponentFromMetadata</span><span class="token punctuation">(</span>
  meta<span class="token operator">:</span> R3ComponentMetadata<span class="token punctuation">,</span>
  constantPool<span class="token operator">:</span> ConstantPool<span class="token punctuation">,</span>
  bindingParser<span class="token operator">:</span> BindingParser
<span class="token punctuation">)</span><span class="token operator">:</span> R3ComponentDef <span class="token punctuation">{</span>
  <span class="token comment">// 其他暂时省略</span>

  <span class="token comment">// 创建一个 TemplateDefinitionBuilder，用于创建模板相关的处理</span>
  <span class="token keyword">const</span> templateBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateDefinitionBuilder</span><span class="token punctuation">(</span>
      constantPool<span class="token punctuation">,</span> BindingScope<span class="token punctuation">.</span><span class="token function">createRootScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> templateTypeName<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> templateName<span class="token punctuation">,</span>
      directiveMatcher<span class="token punctuation">,</span> directivesUsed<span class="token punctuation">,</span> meta<span class="token punctuation">.</span>pipes<span class="token punctuation">,</span> pipesUsed<span class="token punctuation">,</span> <span class="token constant">R3</span><span class="token punctuation">.</span>namespaceHTML<span class="token punctuation">,</span>
      meta<span class="token punctuation">.</span>relativeContextFilePath<span class="token punctuation">,</span> meta<span class="token punctuation">.</span>i18nUseExternalIds<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 创建模板解析相关指令，包括：</span>
  <span class="token comment">// 第一轮：创建模式，包括所有创建模式指令（例如解析侦听器中的绑定）</span>
  <span class="token comment">// 第二轮：绑定和刷新模式，包括所有更新模式指令（例如解析属性或文本绑定）</span>
  <span class="token keyword">const</span> templateFunctionExpression <span class="token operator">=</span> templateBuilder<span class="token punctuation">.</span><span class="token function">buildTemplateFunction</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span>nodes<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 提供这个以便动态生成的组件在实例化时，知道哪些投影内容块要传递给组件</span>
  <span class="token keyword">const</span> ngContentSelectors <span class="token operator">=</span> templateBuilder<span class="token punctuation">.</span><span class="token function">getNgContentSelectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ngContentSelectors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    definitionMap<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;ngContentSelectors&quot;</span><span class="token punctuation">,</span> ngContentSelectors<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 生成 ComponentDef 的 consts 部分</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> constExpressions<span class="token punctuation">,</span> prepareStatements <span class="token punctuation">}</span> <span class="token operator">=</span> templateBuilder<span class="token punctuation">.</span><span class="token function">getConsts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>constExpressions<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> constsExpr<span class="token operator">:</span> o<span class="token punctuation">.</span>LiteralArrayExpr<span class="token operator">|</span>o<span class="token punctuation">.</span>FunctionExpr <span class="token operator">=</span> o<span class="token punctuation">.</span><span class="token function">literalArr</span><span class="token punctuation">(</span>constExpressions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将 consts 转换为函数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prepareStatements<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      constsExpr <span class="token operator">=</span> o<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>prepareStatements<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">o</span><span class="token punctuation">.</span><span class="token function">ReturnStatement</span><span class="token punctuation">(</span>constsExpr<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    definitionMap<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;consts&quot;</span><span class="token punctuation">,</span> constsExpr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 生成 ComponentDef 的 template 部分</span>
  definitionMap<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">&quot;template&quot;</span><span class="token punctuation">,</span> templateFunctionExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可见，在组件编译时，会被编译成一系列的指令，包括<code>const</code>、<code>vars</code>、<code>directives</code>、<code>pipes</code>、<code>styles</code>、<code>changeDetection</code>等等，当然也包括<code>template</code>模板里的相关指令。最终生成的这些指令，会体现在编译后的组件中，比如前面<a href="">《Angular 框架解读--Ivy 编译器之心智模型》</a>中提到的这样一个<code>Component</code>文件：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> Input <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">;</span>

@<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">&quot;greet&quot;</span><span class="token punctuation">,</span>
  template<span class="token operator">:</span> <span class="token string">&quot;&lt;div&gt; Hello, {{name}}! &lt;/div&gt;&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">GreetComponent</span> <span class="token punctuation">{</span>
  @<span class="token function">Input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>经<code>ngtsc</code>编译后，产物包括该组件的<code>.js</code>文件：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> i0 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@angular/core&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">GreetComponent</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
GreetComponent<span class="token punctuation">.</span>ɵcmp <span class="token operator">=</span> i0<span class="token punctuation">.</span><span class="token function">ɵɵdefineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> GreetComponent<span class="token punctuation">,</span>
  tag<span class="token operator">:</span> <span class="token string">&quot;greet&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">factory</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">GreetComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">template</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">rf<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rf <span class="token operator">&amp;</span> RenderFlags<span class="token punctuation">.</span>Create<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      i0<span class="token punctuation">.</span><span class="token function">ɵɵelementStart</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      i0<span class="token punctuation">.</span><span class="token function">ɵɵtext</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      i0<span class="token punctuation">.</span><span class="token function">ɵɵelementEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rf <span class="token operator">&amp;</span> RenderFlags<span class="token punctuation">.</span>Update<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      i0<span class="token punctuation">.</span><span class="token function">ɵɵadvance</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      i0<span class="token punctuation">.</span><span class="token function">ɵɵtextInterpolate1</span><span class="token punctuation">(</span><span class="token string">&quot;Hello &quot;</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">&quot;!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>其中，<code>elementStart()</code>、<code>text()</code>、<code>elementEnd()</code>、<code>advance()</code>、<code>textInterpolate1()</code>这些都是增量 DOM 相关的指令。在实际创建组件的时候，其<code>template</code>模板函数也会被执行，相关的指令也会被执行。</p> <p>正因为在 Ivy 中，是由组件来引用着相关的模板指令。如果组件不引用某个指令，则我们的 Angular 中永远不会使用到它。因为组件编译的过程发生在编译过程中，因此我们可以根据引用到指令，来排除未引用的指令，从而可以在 Tree-shaking 过程中，将未使用的指令从包中移除，这便是增量 DOM 可树摇的原因。</p> <h2 id="结束语"><a href="#结束语" class="header-anchor">#</a> 结束语</h2> <p>现在，我们已经知道在 Ivy 中，是通过编译器将模板编译为<code>template</code>渲染函数，其中会将对模板的解析编译成增量 DOM 相关的指令。其中，在<code>elementStart()</code>执行时，我们可以看到会通过<code>createElementNode()</code>方法来创建 DOM。实际上，增量 DOM 的设计远不止只是创建 DOM，还包括变化检测等各种能力，关于具体的渲染过程，我们会在下一讲中进行介绍。</p> <h3 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h3> <ul><li><a href="https://medium.com/google-developers/introducing-incremental-dom-e98f79ce2c5f" target="_blank" rel="noopener noreferrer">Introducing Incremental DOM<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://indepth.dev/posts/1062/ivy-engine-in-angular-first-in-depth-look-at-compilation-runtime-and-change-detection" target="_blank" rel="noopener noreferrer">Ivy engine in Angular: first in-depth look at compilation, runtime and change detection<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.nrwl.io/understanding-angular-ivy-incremental-dom-and-virtual-dom-243be844bf36" target="_blank" rel="noopener noreferrer">Understanding Angular Ivy: Incremental DOM and Virtual DOM<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <!----> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/godbasin/front-end-playground/edit/sourcecode/docs/angular/deep-into-angular/angular-design-ivy-5-incremental-dom.md" target="_blank" rel="noopener noreferrer">帮阿猪改善此页面！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <blockquote>部分文章中使用了一些网站的截图，如果涉及侵权，请告诉我删一下谢谢~</blockquote> <div style="margin-top:30px;"><div class="el-row" style="margin-left:-10px;margin-right:-10px;"><div class="el-col el-col-24 el-col-sm-0 el-col-md-2 el-col-lg-4" style="padding-left:10px;padding-right:10px;display:block;"><div style="width:1px;height:1px;"></div></div> <div class="el-col el-col-24 el-col-sm-24 el-col-md-18 el-col-lg-16" style="padding-left:10px;padding-right:10px;"><div class="el-card box-card is-always-shadow"><div class="el-card__header"><div class="clearfix"><span>温馨提示喵</span></div></div><div class="el-card__body"> <div class="el-row" style="margin-left:-10px;margin-right:-10px;"><div class="el-col el-col-24 el-col-xs-24 el-col-sm-12" style="padding-left:10px;padding-right:10px;"><div class="el-image"><div class="image-slot"><img src="https://github-imglib-1255459943.cos.ap-chengdu.myqcloud.com/assets/img/loading.gif" style="width:100%;"></div><!----></div></div> <div class="el-col el-col-24 el-col-xs-24 el-col-sm-12" style="padding-left:10px;padding-right:10px;"><div class="copyright-text"><div>本文版权归作者所有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。</div> <div>出处：被删的前端游乐场</div> <div>作者：<a href="https://github.com/godbasin" target="_blank">被删</a></div></div></div></div></div></div></div></div></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-4-aot-jit.html" class="prev">
          13.Ivy编译器之AOT/JIT
        </a></span> <span class="next"><a href="/front-end-playground/angular/deep-into-angular/angular-design-ivy-6-detect-change.html">
          15.Ivy编译器之变更检测
        </a>
        →
      </span></p></div>  <div class="gitalk-container theme-default-content"><div id="gitalk-container" class="content"></div></div></main> <div id="kitty-container"><span><div role="tooltip" id="el-popover-1493" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><img src="https://github-imglib-1255459943.cos.ap-chengdu.myqcloud.com/2code2.jpg" class="image"> <div class="text">牡羊猪的猫粮罐</div> </div><span class="el-popover__reference-wrapper"><div id="kitty" style="background:url(https://github-imglib-1255459943.cos.ap-chengdu.myqcloud.com/assets/img/kitty2.svg);"></div></span></span> <div class="el-dialog__wrapper" style="display:none;"><div role="dialog" aria-modal="true" aria-label="牡羊猪是这样渐渐胖成猪的喵（点击图片可以切换噢）" class="el-dialog" style="margin-top:15vh;"><div class="el-dialog__header"><span class="el-dialog__title">牡羊猪是这样渐渐胖成猪的喵（点击图片可以切换噢）</span><button type="button" aria-label="Close" class="el-dialog__headerbtn"><i class="el-dialog__close el-icon el-icon-close"></i></button></div><!----><!----></div></div></div></div><div class="global-ui"></div></div>
    <script src="/front-end-playground/assets/js/app.ef7e5b0a.js" defer></script><script src="/front-end-playground/assets/js/2.e5aa9928.js" defer></script><script src="/front-end-playground/assets/js/3.ab142917.js" defer></script><script src="/front-end-playground/assets/js/33.1c65d23c.js" defer></script>
  </body>
</html>
